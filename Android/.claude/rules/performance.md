# performance.md

Last Updated: 2026-02-02 15:00:00

## 목적

LivePlan Android가 기능이 늘어나도 앱이 무겁지 않게(용량/성능/배터리/위젯 안정성) 유지하기 위한 성능·경량화 규칙을 고정한다.

## 적용 범위

`:app` (메인 앱), `:core` (도메인), `:data` (저장), `:widget` (위젯), `:shortcuts` (타일/단축키) 전반.

## 핵심 원칙(요약)

- 외부 의존성은 기본 금지(예외 승인 시에만 1개씩).
- 위젯/타일은 "경량 읽기 + 경량 선정 + 렌더"만 수행.
- 저장은 단순·예측 가능해야 하며, 데이터가 무한히 커지지 않게 방지장치 둠.
- WorkManager 주기적 갱신은 허용하되, 갱신 작업은 최소 작업만(배터리/시간 예산).
- 어떤 오류에도 앱/위젯이 크래시하면 실패. 항상 fail-safe.

────────────────────────────────────────
## A. "무거워지지 않기" 예산(기준)
────────────────────────────────────────

### A1. 외부 의존성 원칙(강행)

**기본 원칙**: 외부 의존성은 기본 금지.

**예외 승인 프로세스 체크리스트**
1. 대안 비교: 표준 라이브러리로 해결 가능한가?
2. 비용 평가: 앱 번들 용량 증가량, 런타임 비용
3. 제거 플랜: 나중에 제거 가능한가?
4. 범위 제한: 특정 모듈에만 격리 가능한가?

**금지되는 의존성(Phase 1)**
- 분석/트래킹/광고 SDK
- 대형 UI 프레임워크(앱 전체 테마 대체)
- 네트워크 기반 데이터베이스 SDK

### A2. 리소스(이미지/폰트) 최소화(강행)

- 커스텀 폰트는 Phase 1에서 금지
- 이미지 리소스는 최소화(아이콘은 Material Icons 우선)
- 위젯에는 텍스트/간단한 그래픽만 사용

### A3. 저장소 크기 증가 방지(정책)

**기본 원칙**
- 저장 데이터는 "필요 최소"만 보관
- 파생 데이터(표시용 스냅샷)는 캐시하되, 원천과 불일치 시 재생성

**CompletionLog 증가 방지**
- Phase 1: 제한 없이 시작하되 안전장치 준비
- Phase 2+: retention 정책 도입 검토 (예: 최근 365일만 보관)

**정리 작업 위치**
- 정리 작업은 위젯/타일에서 실행 금지
- 앱 본체 실행 시(유휴 시점)에서만 수행

────────────────────────────────────────
## B. 위젯/타일 성능 원칙
────────────────────────────────────────

### B1. 위젯은 경량 연산만(강행)

**허용되는 작업(최대 범위)**
- Room DB에서 캐시된 요약 데이터 읽기
- `:core`의 순수 함수로 outstanding 계산(Top N + counters)
- Glance Composable 렌더링

**금지되는 작업**
- 대규모 데이터 전체 스캔
- 마이그레이션/정리 작업
- 네트워크 호출

### B2. Room 쿼리 최적화

**기본 원칙**
- "읽기 1회 → 계산 1회"를 넘지 않음
- 인덱스 적절히 활용

**권장 캐시 전략**
- 앱이 데이터 변경 시 "위젯용 요약 테이블" 미리 계산 저장
- 위젯은 요약 테이블만 읽고 렌더

### B3. Quick Settings Tile 성능

- 탭 → 즉시 응답 필수 (200ms 이내 권장)
- 무거운 작업은 백그라운드로 위임 후 결과 알림
- 연속 탭에 대한 멱등성 보장

────────────────────────────────────────
## C. 배터리/백그라운드 정책
────────────────────────────────────────

### C1. WorkManager 주기적 갱신

**허용 정책**
- 최소 간격: 15분
- 권장 간격: 30분

**갱신 작업 범위 제한(강행)**
- Room DB 읽기
- outstanding 선정 (Top N)
- 위젯 상태 업데이트

**금지**
- 정리/마이그레이션
- 전체 데이터 스캔
- 다중 테이블 쓰기

### C2. 불필요한 타이머/폴링 금지(강행)

- 앱에서 "상시 타이머로 상태 갱신" 패턴 금지
- 위젯/타일에서 타이머/폴링 절대 금지

### C3. Doze 모드 대응

- 핵심 기능은 Doze 모드에서도 "다음 활성화 시 정상 동작" 설계
- Exact Alarm 사용 최소화

────────────────────────────────────────
## D. 장애/복구 정책
────────────────────────────────────────

### D1. 저장소 손상 시 fail-safe(강행)

**목표**: Room DB 손상/쿼리 실패에도 앱/위젯 크래시 금지

**정책**
- 로드 실패 시
  - 앱: 빈 상태 + 사용자 안내
  - 위젯: 안전 폴백(미완료 0 또는 "앱 열기")
- 자동 초기화(DB 삭제)는 사용자 동의 없이 수행 금지

### D2. 크래시 리포팅(필요 시)

**원칙**: Phase 1에서는 기본적으로 도입 안 함

**도입 시 필수 조건**
- 수집 데이터 범위 최소, 개인정보 무관
- 앱 용량/성능 영향 허용 가능
- 제거 플랜 존재
- Play Store Privacy Policy와 일치

### D3. 관측 가능성(디버그 한정)

- 디버그 빌드에서만 verbose 로그 허용
- 릴리즈 빌드에서는 최소 로그
- 민감정보(프로젝트/태스크 제목)는 로그에 남기지 않음

────────────────────────────────────────
## E. 앱 크기 예산
────────────────────────────────────────

### E1. 목표 APK 크기

| 빌드 타입 | 목표 크기 |
|----------|----------|
| Debug APK | < 30MB |
| Release AAB | < 15MB |

### E2. 크기 증가 요인 모니터링

- 새 라이브러리 추가 시 크기 영향 측정
- 불필요한 리소스 정리(unused resources)
- ProGuard/R8 최적화 설정

끝.
